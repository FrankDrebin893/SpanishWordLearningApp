@page "/"
@using SpanishWordLearner.Services
@inject WordService WordService
@inject ProgressService ProgressService
@rendermode InteractiveServer

<PageTitle>Spanish Word Learner</PageTitle>

<div class="d-flex flex-column align-center mb-8">
    <MudText Typo="Typo.h3" Class="mb-2" Style="font-weight: 600;">Learn Spanish</MudText>
    <MudText Typo="Typo.body1" Color="Color.Secondary">
        Master the @WordService.TotalWordCount most common words
    </MudText>
</div>

@if (!_loaded)
{
    <div class="d-flex justify-center py-8">
        <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
    </div>
}
else
{
    <MudPaper Elevation="0" Class="pa-6 mb-6 rounded-lg" Style="border: 1px solid #E2E8F0;">
        <MudText Typo="Typo.h6" Class="mb-4" Style="font-weight: 500;">Your Progress</MudText>

        <MudGrid Spacing="3" Class="mb-4">
            <MudItem xs="4">
                <div class="text-center">
                    <MudText Typo="Typo.h4" Color="Color.Primary" Style="font-weight: 600;">@_wordsLearned</MudText>
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Learned</MudText>
                </div>
            </MudItem>
            <MudItem xs="4">
                <div class="text-center">
                    <MudText Typo="Typo.h4" Color="Color.Info" Style="font-weight: 600;">@_wordsSeen</MudText>
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Seen</MudText>
                </div>
            </MudItem>
            <MudItem xs="4">
                <div class="text-center">
                    <MudText Typo="Typo.h4" Color="Color.Success" Style="font-weight: 600;">@_quizzesTaken</MudText>
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Quizzes</MudText>
                </div>
            </MudItem>
        </MudGrid>

        <MudProgressLinear Color="Color.Primary" Rounded="true" Size="Size.Large"
                           Value="@(_progressPercent)" Class="mb-2" />
        <MudText Typo="Typo.caption" Color="Color.Secondary" Align="Align.Center">
            @_wordsLearned of @WordService.TotalWordCount words learned (@_progressPercent.ToString("F0")%)
        </MudText>
    </MudPaper>

    <MudGrid Spacing="3" Class="mb-6">
        <MudItem xs="12" sm="4">
            <MudCard Elevation="0" Class="h-100" Style="border: 1px solid #E2E8F0;">
                <MudCardContent Class="d-flex flex-column align-center pa-6">
                    <MudIcon Icon="@Icons.Material.Rounded.School" Size="Size.Large" Color="Color.Primary" Class="mb-3" />
                    <MudText Typo="Typo.h6" Class="mb-2">Learn</MudText>
                    <MudText Typo="Typo.body2" Color="Color.Secondary" Align="Align.Center" Class="mb-4">
                        Study with flashcards ordered by frequency
                    </MudText>
                    <MudButton Variant="Variant.Filled" Color="Color.Primary" Href="/learn" FullWidth="true">
                        Start Learning
                    </MudButton>
                </MudCardContent>
            </MudCard>
        </MudItem>
        <MudItem xs="12" sm="4">
            <MudCard Elevation="0" Class="h-100" Style="border: 1px solid #E2E8F0;">
                <MudCardContent Class="d-flex flex-column align-center pa-6">
                    <MudIcon Icon="@Icons.Material.Rounded.Quiz" Size="Size.Large" Color="Color.Success" Class="mb-3" />
                    <MudText Typo="Typo.h6" Class="mb-2">Quiz</MudText>
                    <MudText Typo="Typo.body2" Color="Color.Secondary" Align="Align.Center" Class="mb-4">
                        Test your knowledge with quizzes
                    </MudText>
                    <MudButton Variant="Variant.Filled" Color="Color.Success" Href="/quiz" FullWidth="true">
                        Take a Quiz
                    </MudButton>
                </MudCardContent>
            </MudCard>
        </MudItem>
        <MudItem xs="12" sm="4">
            <MudCard Elevation="0" Class="h-100" Style="border: 1px solid #E2E8F0;">
                <MudCardContent Class="d-flex flex-column align-center pa-6">
                    <MudIcon Icon="@Icons.Material.Rounded.Analytics" Size="Size.Large" Color="Color.Info" Class="mb-3" />
                    <MudText Typo="Typo.h6" Class="mb-2">Statistics</MudText>
                    <MudText Typo="Typo.body2" Color="Color.Secondary" Align="Align.Center" Class="mb-4">
                        Track your learning progress
                    </MudText>
                    <MudButton Variant="Variant.Filled" Color="Color.Info" Href="/statistics" FullWidth="true">
                        View Stats
                    </MudButton>
                </MudCardContent>
            </MudCard>
        </MudItem>
    </MudGrid>

    <MudExpansionPanels Elevation="0" Class="rounded-lg" Style="border: 1px solid #E2E8F0;">
        <MudExpansionPanel Text="How It Works" Style="font-weight: 500;">
            <MudList T="string" Dense="true">
                <MudListItem Icon="@Icons.Material.Rounded.Lightbulb" IconColor="Color.Primary">
                    <MudText Typo="Typo.body2"><b>Learn mode:</b> Go through flashcards to familiarize yourself with new words</MudText>
                </MudListItem>
                <MudListItem Icon="@Icons.Material.Rounded.CheckCircle" IconColor="Color.Success">
                    <MudText Typo="Typo.body2"><b>Quiz mode:</b> Test your knowledge with multiple choice questions</MudText>
                </MudListItem>
                <MudListItem Icon="@Icons.Material.Rounded.TrendingUp" IconColor="Color.Info">
                    <MudText Typo="Typo.body2"><b>Track progress:</b> Words are "learned" after 3+ correct answers with 70%+ accuracy</MudText>
                </MudListItem>
                <MudListItem Icon="@Icons.Material.Rounded.Sort" IconColor="Color.Warning">
                    <MudText Typo="Typo.body2"><b>Smart ordering:</b> Learn the most common words first!</MudText>
                </MudListItem>
            </MudList>
        </MudExpansionPanel>
    </MudExpansionPanels>
}

@code {
    private bool _loaded;
    private int _wordsLearned;
    private int _wordsSeen;
    private int _quizzesTaken;
    private double _progressPercent => WordService.TotalWordCount > 0
        ? _wordsLearned * 100.0 / WordService.TotalWordCount
        : 0;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            var progress = await ProgressService.GetProgressAsync();
            _wordsLearned = progress.TotalWordsLearned;
            _wordsSeen = progress.WordStats.Count;
            _quizzesTaken = progress.TotalQuizzesTaken;
            _loaded = true;
            StateHasChanged();
        }
    }
}
